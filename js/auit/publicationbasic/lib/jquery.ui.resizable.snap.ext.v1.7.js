(function(d){d.extend(d.ui.resizable.prototype.options,{snapTolerance:20,snapMode:"both"});d.ui.plugin.add("resizable","snap",{start:function(){var j=d(this),i=j.data("resizable"),h=i.options.snap;i.ow=i.helper.outerWidth()-i.size.width;i.oh=i.helper.outerHeight()-i.size.height;i.lm=c(j);i.tm=f(j);i.coords=[];d(typeof h=="string"?h:":data(resizable)").each(function(){if(this==i.element[0]||this==i.helper[0]){return}var n=d(this),o=n.position(),k=o.left+c(n),m=o.top+f(n);i.coords.push({el:n,l:k,t:m,r:k+n.outerWidth(),b:m+n.outerHeight()})})},resize:function(){var m=[],s=[],p=[],x=[],o=d(this).data("resizable"),q=o.axis.split(""),A=o.options.snapTolerance,w=o.options.snapMode,k=o.position.left+o.lm,j=k-A,z=o.position.top+o.tm,y=z-A,h=k+o.size.width+o.ow,B=h+A,v=z+o.size.height+o.oh,u=v+A;d.each(o.coords,function(){var r=this,l=Math.min(B,r.r)-Math.max(j,r.l),n=Math.min(u,r.b)-Math.max(y,r.t);if(l<0||n<0){return}d.each(q,function(t,C){if(w=="outer"){switch(C){case"w":case"e":if(l>A*2){return}break;case"n":case"s":if(n>A*2){return}}}else{if(w=="inner"){switch(C){case"w":case"e":if(l<A*2){return}break;case"n":case"s":if(n<A*2){return}}}}switch(C){case"w":m.push(b(k-r.l,k-r.r,A));break;case"n":s.push(b(z-r.t,z-r.b,A));break;case"e":var D=b(h-r.l,h-r.r,A);if(D>0){o.size.wEl=r.el}p.push(D);break;case"s":var D=b(v-r.t,v-r.b,A);if(D>0){o.size.hEl=r.el}x.push(D);break}})});if(x.length){o.size.height+=a(x)}if(p.length){o.size.width+=a(p)}if(m.length){var i=a(m);o.position.left+=i;o.size.width-=i}if(s.length){var i=a(s);o.position.top+=i;o.size.height-=i}}});function b(h,j,i){return Math.abs(h)<i?-h:Math.abs(j)<i?-j:0}function a(h){return h.sort(function(j,i){return !j?1:!i?-1:Math.abs(j)-Math.abs(i)})[0]}function c(h){return parseInt(h.css("margin-left"),10)||0}function f(h){return parseInt(h.css("margin-top"),10)||0}function g(j,k,h){var i=d.ui.resizable.prototype[j];d.ui.resizable.prototype[j]=function(){if(h){h.apply(this,arguments)}i.apply(this,arguments);if(k){k.apply(this,arguments)}}}g("_mouseStop",null,function(){if(this._helper){this.position={left:parseInt(this.helper.css("left"),10)||0.1,top:parseInt(this.helper.css("top"),10)||0.1};this.size={width:this.helper.outerWidth(),height:this.helper.outerHeight()}}});g("_mouseStart",function(){if(this._helper){this.size={width:this.size.width-(this.helper.outerWidth()-this.helper.width()),height:this.size.height-(this.helper.outerHeight()-this.helper.height())};this.originalSize={width:this.size.width,height:this.size.height}}});g("_renderProxy",function(){if(this._helper){this.helper.css({left:this.elementOffset.left,top:this.elementOffset.top,width:this.element.outerWidth(),height:this.element.outerHeight()})}});var e=d.ui.resizable.prototype.plugins.resize;d.each(e,function(i,h){if(h[0]=="ghost"){e.splice(i,1);return false}});d.each(d.ui.resizable.prototype.plugins.start,function(i,h){if(h[0]=="ghost"){var j=h[1];h[1]=function(){j.apply(this,arguments);d(this).data("resizable").ghost.css({width:"100%",height:"100%"})};return false}})})(jQuery);