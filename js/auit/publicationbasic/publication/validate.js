(function($){if(window.AuIt==undefined){window.AuIt={}}var oldRS=$.ui.resizable.prototype._mouseStart;$.ui.resizable.prototype._mouseStart=function(event){var r=oldRS.call(this,event);var el=this.element;this.size={width:el.outerWidth(),height:el.outerHeight()};this.originalSize={width:el.outerWidth(),height:el.outerHeight()};this.sizeDiff={width:0,height:0};return r};AuIt.ElementToJSON=function(elm){var copy=ko.toJS(elm);delete copy.__ko_mapping__;delete copy["$type"];delete copy["$type_"];var d=[];for(var i in copy){if($.isFunction(copy[i])){d.push(i)}}for(var i=0;i<d.length;i++){delete copy[d[i]]}return copy};var roundValue=function(value,precision){var roundingMultiplier=Math.pow(10,precision),newValueAsNum=isNaN(value)?0:parseFloat(value);return Math.round(newValueAsNum*roundingMultiplier)/roundingMultiplier};var toMM=function(value){return parseFloat(value,10)};var toParam=function(value,model){if(isNaN(parseFloat(value,10))){if(AuIt.Publication){if(model){switch(value){case"pr":value=model.width();break;case"pb":value=model.height();break}}}}return toMM(value)};var calcValue=function(value,def,model){value=value.replace(/ /g,"");if(!value){return value}try{var operands={"+":1,"-":1,"*":1,"/":1,"(":1,")":1};var i,c,o="",op=[];for(i=0;i<value.length;i++){c=value[i];if(operands[c]){if(o){op.push(toParam(o,model))}o="";op.push(c)}else{o+=c}}if(o){op.push(toParam(o,model))}o="";value=op.join("");if(value){value=""+eval(value)}}catch(e){value=def}return value};ko.extenders.calculator=function(target,opt){var result=ko.computed({read:target,write:function(newValue){newValue=jQuery.trim(newValue);var current=target(),valueToWrite=newValue;valueToWrite=""+calcValue(newValue,current,opt.m);if(valueToWrite!==current){target(valueToWrite)}else{if(newValue!==current){target.notifySubscribers(valueToWrite)}}}});result(target());return result};ko.extenders.unit=function(target,opt){opt.precision=opt.precision?opt.precision:2;opt.unit=opt.unit?opt.unit:"";var result=ko.computed({read:target,write:function(newValue){newValue=jQuery.trim(newValue);var uidx=0;var current=target(),valueToWrite=newValue;if($.isArray(opt.unit)){for(var i=0;i<opt.unit.length;i++){var o=opt.unit[i];var x=newValue.substr(newValue.length-o.length);if(x==o){uidx=i;break}}}valueToWrite=""+calcValue(newValue,current,opt.m);if(valueToWrite=="NaN"){valueToWrite=""}if(valueToWrite){valueToWrite=parseFloat(valueToWrite,10);valueToWrite=roundValue(valueToWrite,opt.precision);if($.isArray(opt.unit)){valueToWrite+=opt.unit[uidx]}else{valueToWrite+=opt.unit}}if(valueToWrite!==current){target(valueToWrite)}else{if(newValue!==current){target.notifySubscribers(valueToWrite)}}}});result(target());return result};ko.extenders.numeric=function(target,precision){var result=ko.computed({read:target,write:function(newValue){var current=target(),valueToWrite=roundValue(newValue,precision);if(valueToWrite!==current){target(valueToWrite)}else{if(newValue!==current){target.notifySubscribers(valueToWrite)}}}});result(target());return result};ko.bindingHandlers.uiTabs={init:function(el){$(el).tabs({select:function(){alert("hello")}})}};ko.bindingHandlers.uiAccordion={init:function(el){$(el).accordion({heightStyle:"content"})}};ko.bindingHandlers.accordion={init:function(element,valueAccessor){var opt=$.extend({},valueAccessor()||{});opt.active=opt.active();opt.heightStyle="content";opt.changestart=function(event,ui,c){var options=valueAccessor()||{};options.active(ui.newContent.length?0:1)};setTimeout(function(){},0);$(element).accordion(opt);ko.utils.domNodeDisposal.addDisposeCallback(element,function(){$(element).accordion("destroy")})},update:function(element,valueAccessor){}};ko.bindingHandlers.selectable={init:function(element,valueAccessor){$(element).attr("id","selectable").selectable({selected:function(event,ui){var x=valueAccessor();x($(ui.selected).attr("data-index"))},unselected:function(event,ui){var x=valueAccessor();x(-1)}})},update:function(element,valueAccessor){}};ko.bindingHandlers.combobox={init:function(element,valueAccessor){var observable=valueAccessor();$(element).combobox();$(element).next("span.ui-combobox").find("input").bind("autocompleteselect autocompletechange",function(event,ui){if(!ui.item&&$(element).attr("data-addcmb")){observable(""+this.value);var v=observable();observable.notifySubscribers(v)}else{if(ui.item){observable(ui.item?ui.item.option.value:"")}else{ui.item=null;if(!$(element).attr("data-empty")){observable($(element).attr("data-default")?$(element).attr("data-default"):"")}}}})},update:function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor());var f=function(){var label="";$(element).children("option").each(function(){if(this.value==value){label=this.text;return false}});if(!label&&value&&$(element).attr("data-addcmb")){var v=label=value;$(element).append('<option value="'+v+'">'+v+"</option>")}var cmb=$(element).next("span.ui-combobox");var inp=$(element).next("span.ui-combobox").find("input");inp.val(label);$(element).next("span.ui-combobox").find("input").val(label)};setTimeout(f,0)}};ko.bindingHandlers.sku={init:function(element,valueAccessor){$(element).addClass("r ui-widget ui-widget-content ui-corner-all").autocomplete({source:AuIt.Publication.options.searchurl,minLength:1,select:function(event,ui){valueAccessor()(ui.item.value)}})},update:function(element,valueAccessor){}};ko.bindingHandlers.inp_menu={init:function(element,valueAccessor){$("<a>").attr("tabIndex",-1).insertAfter(element).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-combobox-toggle").click(function(){$(this).blur();var observable=valueAccessor();var fn=$(element).attr("data-click");if(observable[fn]){observable[fn](this)}return false})},update:function(element,valueAccessor){}};ko.bindingHandlers.showGenOption={_dlg:null,_btn:null,_model:null,_create:function(){if(!ko.bindingHandlers.showGenOption._dlg){ko.bindingHandlers.showGenOption._dlg=$("#snm-publication-gen-option");ko.bindingHandlers.showGenOption._dlg.css({position:"absolute"});$(document).mousedown(function(ev){var target=ev.target;var btn=ko.bindingHandlers.showGenOption._btn;var top=ko.bindingHandlers.showGenOption._dlg[0];if(!btn||target==btn||target==top){return}var parents=$(target).parents().get();for(var j=0;j<parents.length;j++){if(parents[j]==btn||parents[j]==top){return true}}ko.bindingHandlers.showGenOption._close()})}},_open:function(element){ko.bindingHandlers.showGenOption._btn=element;ko.bindingHandlers.showGenOption._create();ko.bindingHandlers.showGenOption._dlg.show().position({of:$(element),my:"right top",at:"right bottom",offset:"0 0",})},_close:function(){ko.bindingHandlers.showGenOption._btn=null;if(ko.bindingHandlers.showGenOption._dlg){ko.bindingHandlers.showGenOption._model.save();ko.bindingHandlers.showGenOption._dlg.hide()}},init:function(element,valueAccessor){$(element).click(function(){$(this).blur();var obj=valueAccessor();if(!ko.bindingHandlers.showGenOption._model){var model=new AuIt.Publication.GenOptions();ko.bindingHandlers.showGenOption._model=model;ko.applyBindings(model,document.getElementById("snm-publication-gen-option"))}ko.bindingHandlers.showGenOption._model.load(obj);ko.bindingHandlers.showGenOption._open(this);return false})},update:function(element,valueAccessor){}};ko.bindingHandlers.colour={init:function(element,valueAccessor){var obj=valueAccessor();$(element).addClass("r ui-widget ui-widget-content ui-corner-all").colorpicker({colorFormat:obj.m,parts:["map","bar","hex","hsv","rgb","alpha","lab","cmyk"],alpha:true,select:function(event,color){var toProz=function(c){c=Math.round(c*100);if(c>100){c=100}if(c<0){c=0}return c};obj.v(color.formatted);var x="cmyka("+toProz(color.cmyk.c)+","+toProz(color.cmyk.m)+","+toProz(color.cmyk.y)+","+toProz(color.cmyk.k)+","+toProz(color.a)+")";obj.c(x)}}).on("change",function(){})},update:function(element,valueAccessor){}};ko.extenders.fontChanged=function(target,style){target.subscribe(function(newValue){var i,l,f=AuIt.StyleManagerOption.fonts;for(i=0,l=f.length;i<l;i++){if(f[i].uid==newValue){style(f[i].styles[0].uid);return}}style(":")});return target}})(jQuery);