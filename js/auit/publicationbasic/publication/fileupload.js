(function(a){if(window.AuIt==undefined){window.AuIt={}}AuIt.FileUpload2=function(){var e;var i;var d;var g=null;function b(k){if(k&&k.error){alert(k.error)}}function f(k){if(k.lengthComputable){var l=Math.round(k.loaded*100/k.total);a(g.progress.text).html(l.toString()+"%");a(g.progress.percent).width(l.toString()+"%")}}function h(k){var l=jQuery.parseJSON(this.response);if(!l||l.status!=1){b(l);e=null}if(g.cb){g.cb(l)}AuIt.FileUpload2.uploadNextFile()}function c(k){e=null;AuIt.FileUpload2.uploadNextFile();alert(g.msg.m1)}function j(k){e=null;AuIt.FileUpload2.uploadNextFile();alert(g.msg.m2)}return{fileSelected:function(k){if(e){return}g=k;a(g.dialog).dialog("disable");if(g.tree){var m=a(g.tree).jstree("get_selected").attr("id");a(g.tree).attr("disabled","disabled");d=m}var l=document.getElementById(g.inp_files_id).files;e=l;i=0;AuIt.FileUpload2.uploadNextFile()},uploadNextFile:function(){if(!e||i>=e.length){e=null;d=null;a(g.progress_block).hide();a(g.dialog).dialog("enable");if(g.tree){var l=jQuery.jstree._reference(g.tree);var o=l._get_node(null,false);var k=l._get_parent(o);l.refresh(k)}return}var n=e[i++];if(n.size>=g.MaxUploadSize){alert(g.msg.m10);e=null;this.uploadNextFile();return}a(g.progress.text).html("");a(g.progress.percent).width("0%");a(g.progress_block).show();var m=new FormData();m.append("aimage",n);m.append("id",d);m.append("form_key",g.formKey);m.append("operation",g.operation);var p=new XMLHttpRequest();p.upload.addEventListener("progress",f,false);p.addEventListener("load",h,false);p.addEventListener("error",c,false);p.addEventListener("abort",j,false);p.open("POST",g.url);p.send(m)}}}()}(jQuery));