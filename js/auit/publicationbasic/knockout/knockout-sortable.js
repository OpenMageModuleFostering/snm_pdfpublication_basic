(function(a){if(typeof define==="function"&&define.amd){define(["knockout","jquery","jquery.ui.sortable"],a)}else{a(window.ko,jQuery)}})(function(l,f){var i="ko_sortItem",h="ko_sourceIndex",k="ko_sortList",c="ko_parentList",d="ko_dragItem",g=l.utils.unwrapObservable,j=l.utils.domData.get,e=l.utils.domData.set;var b=function(o,n){l.utils.arrayForEach(o,function(p){if(p.nodeType===1){e(p,i,n);e(p,c,j(p.parentNode,k))}})};var a=function(r,o){var n={},p=g(r())||{},q;if(p.data){n[o]=p.data;n.name=p.template}else{n[o]=r()}l.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions"],function(s){n[s]=p[s]||l.bindingHandlers.sortable[s]});if(o==="foreach"){if(n.afterRender){q=n.afterRender;n.afterRender=function(s,t){b.call(t,s,t);q.call(t,s,t)}}else{n.afterRender=b}}return n};var m=function(p,o){var n=g(o);if(n){for(var q=0;q<p;q++){if(n[q]&&g(n[q]._destroy)){p++}}}return p};l.bindingHandlers.sortable={init:function(s,u,p,r,n){var y=f(s),v=g(u())||{},w=a(u,"foreach"),q={},x,o;y.contents().each(function(){if(this&&this.nodeType!==1){s.removeChild(this)}});f.extend(true,q,l.bindingHandlers.sortable);if(v.options&&q.options){l.utils.extend(q.options,v.options);delete v.options}l.utils.extend(q,v);if(q.connectClass&&(l.isObservable(q.allowDrop)||typeof q.allowDrop=="function")){l.computed({read:function(){var A=g(q.allowDrop),z=typeof A=="function"?A.call(this,w.foreach):A;l.utils.toggleDomNodeCssClass(s,q.connectClass,z)},disposeWhenNodeIsRemoved:s},this)}else{l.utils.toggleDomNodeCssClass(s,q.connectClass,q.allowDrop)}l.bindingHandlers.template.init(s,function(){return w},p,r,n);x=q.options.start;o=q.options.update;var t=setTimeout(function(){var z;y.sortable(l.utils.extend(q.options,{start:function(B,C){var A=C.item[0];e(A,h,l.utils.arrayIndexOf(C.item.parent().children(),A));C.item.find("input:focus").change();if(x){x.apply(this,arguments)}},receive:function(A,B){z=j(B.item[0],d);if(z){if(z.clone){z=z.clone()}if(q.dragged){z=q.dragged.call(this,z,A,B)||z}}},update:function(A,H){var B,E,G,D,J,C=H.item[0],F=H.item.parent()[0],I=j(C,i)||z;z=null;if(I&&(this===F||f.contains(this,F))){B=j(C,c);G=j(C,h);E=j(C.parentNode,k);D=l.utils.arrayIndexOf(H.item.parent().children(),C);if(!w.includeDestroyed){G=m(G,B);D=m(D,E)}if(q.beforeMove||q.afterMove){J={item:I,sourceParent:B,sourceParentNode:B&&H.sender||C.parentNode,sourceIndex:G,targetParent:E,targetIndex:D,cancelDrop:false};if(q.beforeMove){q.beforeMove.call(this,J,A,H)}}if(B){f(B===E?this:H.sender).sortable("cancel")}else{f(C).remove()}if(J&&J.cancelDrop){return}if(D>=0){if(B){B.splice(G,1);if(l.processAllDeferredBindingUpdates){l.processAllDeferredBindingUpdates()}}E.splice(D,0,I)}e(C,i,null);if(l.processAllDeferredBindingUpdates){l.processAllDeferredBindingUpdates()}if(q.afterMove){q.afterMove.call(this,J,A,H)}}if(o){o.apply(this,arguments)}},connectWith:q.connectClass?"."+q.connectClass:false}));if(q.isEnabled!==undefined){l.computed({read:function(){y.sortable(g(q.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:s})}},0);l.utils.domNodeDisposal.addDisposeCallback(s,function(){if(y.data("ui-sortable")||y.data("sortable")){y.sortable("destroy")}clearTimeout(t)});return{controlsDescendantBindings:true}},update:function(o,q,s,r,n){var p=a(q,"foreach");e(o,k,p.foreach);l.bindingHandlers.template.update(o,function(){return p},s,r,n)},connectClass:"ko_container",allowDrop:true,afterMove:null,beforeMove:null,options:{}};l.bindingHandlers.draggable={init:function(r,t,p,q,n){var w=g(t())||{},x=w.options||{},o=l.utils.extend({},l.bindingHandlers.draggable.options),v=a(t,"data"),s=w.connectClass||l.bindingHandlers.draggable.connectClass,u=w.isEnabled!==undefined?w.isEnabled:l.bindingHandlers.draggable.isEnabled;w=w.data||w;e(r,d,w);l.utils.extend(o,x);o.connectToSortable=s?"."+s:false;f(r).draggable(o);if(u!==undefined){l.computed({read:function(){f(r).draggable(g(u)?"enable":"disable")},disposeWhenNodeIsRemoved:r})}return l.bindingHandlers.template.init(r,function(){return v},p,q,n)},update:function(o,q,s,r,n){var p=a(q,"data");return l.bindingHandlers.template.update(o,function(){return p},s,r,n)},connectClass:l.bindingHandlers.sortable.connectClass,options:{helper:"clone"}}});